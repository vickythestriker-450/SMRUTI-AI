<!DOCTYPE html>
<html lang="or">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<title>ସ୍ମୃତି AI</title>

<meta name="theme-color" content="#00eaff">

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #021425, #000);
  color: #00eaff;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

#avatar {
  height: 45vh;
  width: 100%;
}

#caption {
  text-align: center;
  font-size: 14px;
  padding: 6px;
  min-height: 20px;
}

#chat {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
}

.msg {
  margin: 6px 0;
  line-height: 1.4;
}

.user { color: #fff; }
.ai { color: #00eaff; }

#controls {
  display: flex;
  padding: 8px;
  gap: 6px;
}

input {
  flex: 1;
  font-size: 16px;
  padding: 10px;
  border-radius: 10px;
  border: none;
  outline: none;
  background: #021b2f;
  color: #fff;
}

button {
  font-size: 18px;
  padding: 10px 14px;
  border-radius: 10px;
  border: none;
  background: #00eaff;
  color: #000;
}
</style>
</head>

<body>

<canvas id="avatar"></canvas>
<div id="caption">ସ୍ମୃତି ଆପଣଙ୍କୁ ଶୁଣୁଛି…</div>

<div id="chat"></div>

<div id="controls">
  <input id="text" placeholder="ଏଠାରେ ଲେଖନ୍ତୁ…" />
  <button onclick="send()">▶</button>
</div>

<script>
/* ================== AVATAR ================== */
const canvas = document.getElementById("avatar");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = innerWidth;
  canvas.height = canvas.offsetHeight;
}
resize();
window.onresize = resize;

let mouth = 0;

function drawFace() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;

  // Matrix dots face
  for (let i = 0; i < 220; i++) {
    const a = Math.random() * Math.PI * 2;
    const r = Math.random() * 120;
    const x = cx + Math.cos(a) * r;
    const y = cy + Math.sin(a) * r * 1.2;
    ctx.fillStyle = "#00eaff";
    ctx.fillRect(x, y, 2, 2);
  }

  // Mouth (lip sync)
  ctx.strokeStyle = "#00eaff";
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.arc(cx, cy + 60, 30, 0, Math.PI * mouth);
  ctx.stroke();
}

setInterval(() => {
  mouth += 0.15;
  if (mouth > 2) mouth = 0.5;
  drawFace();
}, 60);

/* ================== CHAT ================== */
const chat = document.getElementById("chat");
const caption = document.getElementById("caption");

function add(text, cls) {
  const d = document.createElement("div");
  d.className = "msg " + cls;
  d.textContent = text;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

function send() {
  const i = document.getElementById("text");
  const text = i.value.trim();
  if (!text) return;
  i.value = "";

  add(text, "user");

  // Demo AI logic (works offline)
  let reply = "ମୁଁ ସ୍ମୃତି। ଆପଣ କହିଥିଲେ: " + text;

  setTimeout(() => {
    add(reply, "ai");
    speak(reply);
  }, 500);
}

/* ================== VOICE ================== */
function speak(text) {
  caption.textContent = text;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "or-IN";     // Odia default
  u.rate = 1;
  u.pitch = 1;

  u.onboundary = () => mouth = 2;
  u.onend = () => mouth = 0.5;

  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}
</script>

</body>
  </html>
